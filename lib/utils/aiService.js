const {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} = require("@google/generative-ai");
require("dotenv").config();
const { reactPrompt } = require("../../prompts/react.prompt");

// const apiKey = process.env.GEMINI_API_KEY;
const apiKey = "AIzaSyDS_ZYKbABqVp88Zj7wgvf7DLqurluHC24";
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-2.0-flash",
  systemInstruction:
    "You are DWARF! ‚Äì an advanced AI code assistant built by Srisailam Kakurala.\n\nYour task is to generate full **production-ready** projects with all functionalities.",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 100000,
  responseMimeType: "text/plain",
};

/**
 * Generates project structure based on user input using Gemini AI.
 * @param {string} projectGoal - The project goal provided by the user.
 * @param {string} techStack - The tech stack for the project.
 * @returns {Promise<string|null>} AI-generated project structure.
 */
async function generateCode(projectGoal, techStack) {
  try {
    const chatSession = await model.startChat({
      generationConfig,
      history: [
        {
          role: "user",
          parts: [
            {text: "\n    Your task is to generate a full **production-ready** React project using Tailwind CSS, React Router, Context API, and React Icons.\n\n    ‚ö° **Project Requirements** ‚ö°  \n    - Ensure a structured, maintainable, and scalable React app.  \n    - Use functional components with React Hooks.  \n    - **Strictly follow latest React features (no deprecated code!).**  \n    - Use **correct file extensions**:\n      - .jsx for all files.\n    - Include error handling, accessibility (a11y), and best practices. \n    - Use **React Icons** for icons and **picsum.photos** for placeholder images.\n\n    üèó **Project Structure** üèó  \n    - **/components** ‚Üí Reusable UI components  \n    - **/pages** ‚Üí Full-page components  \n    - **/hooks** ‚Üí Custom React hooks  \n    - **/context** ‚Üí Global state management  \n    - **/utils** ‚Üí Helper functions  \n    - **/services** ‚Üí API handling  \n    - **/layouts** ‚Üí Page layouts (header, footer, sidebar)  \n    - **/assets** ‚Üí Images, logos, fonts  \n\n    üî• **Generate your response strictly in JSON format: want nothing before or after**  \n\n    example response:\n\n    {\n        \"paths\": {\n            \"App.jsx\": \"/src/App.jsx\",\n            \"main.jsx\": \"/src/main.jsx\",\n            \"index.css\": \"/src/index.css\",\n            \"components/Navbar.jsx\": \"/src/components/Navbar.jsx\",\n            \"components/Footer.jsx\": \"/src/components/Footer.jsx\",\n            \"components/Button.jsx\": \"/src/components/Button.jsx\",\n            \"components/ThemeToggle.jsx\": \"/src/components/ThemeToggle.jsx\",\n            \"layouts/MainLayout.jsx\": \"/src/layouts/MainLayout.jsx\",\n            \"pages/Home.jsx\": \"/src/pages/Home.jsx\",\n            \"pages/About.jsx\": \"/src/pages/About.jsx\",\n            \"hooks/useTheme.jsx\": \"/src/hooks/useTheme.js\",\n            \"hooks/useFetch.jsx\": \"/src/hooks/useFetch.js\",\n            \"context/AppContext.jsx\": \"/src/context/AppContext.js\",\n            \"services/api.jsx\": \"/src/services/api.js\",\n            \"utils/helpers.jsx\": \"/src/utils/helpers.js\"\n        },\n        \"code\": {\n            \"App.jsx\": \"import React from 'react';\\\\n import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\\\\n import MainLayout from './layouts/MainLayout';\\\\n import Home from './pages/Home';\\\\n import About from './pages/About';\\\\n const App = () => {\\\\n return (<Router><MainLayout><Routes><Route path='/' element={<Home />} /><Route path='/about' element={<About />} /></Routes></MainLayout></Router>); }; \\\\n export default App;\",\n\n            \"main.jsx\": \"import React from 'react';\\\\n import ReactDOM from 'react-dom/client';\\\\n import App from './App';\\\\n import { AppProvider } from './context/AppContext';\\\\n import './index.css';\\\\n const root = ReactDOM.createRoot(document.getElementById('root'));\\\\n root.render(<React.StrictMode><AppProvider><App /></AppProvider></React.StrictMode>);\",\n\n            \"index.css\": \"/* No custom styles needed since Tailwind CDN is used */\",\n            \n            \"components/Navbar.jsx\": \"import React from 'react';\\\\n import { Link } from 'react-router-dom';\\\\n const Navbar = () => { return <nav className='bg-gray-900 text-white p-4 flex justify-between'><Link to='/'>üè† Home</Link><Link to='/about'>üìñ About</Link></nav>; }; \\\\n export default Navbar;\",\n\n            \"components/Footer.jsx\": \"import React from 'react';\\\\n const Footer = () => { return <footer className='bg-gray-900 text-white p-4 text-center'>¬© 2025 DWARF AI | Built by Srisailam Kakurala</footer>; }; \\\\n export default Footer;\",\n\n            \"components/Button.jsx\": \"import React from 'react';\\\\n const Button = ({ children, onClick, type = 'button', className = '' }) => { return <button type={type} onClick={onClick} className={\\`px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-500 \\${className}\\`}>{children}</button>; }; \\\\n export default Button;\",\n\n            \"components/ThemeToggle.jsx\": \"import React, { useContext } from 'react';\\\\n import { AppContext } from '../context/AppContext';\\\\n import { FaSun, FaMoon } from 'react-icons/fa';\\\\n const ThemeToggle = () => { const { theme, setTheme } = useContext(AppContext); return <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>{theme === 'light' ? <FaMoon /> : <FaSun />}</button>; }; \\\\n export default ThemeToggle;\",\n\n            \"layouts/MainLayout.jsx\": \"import React from 'react';\\\\n import Navbar from '../components/Navbar';\\\\n import Footer from '../components/Footer';\\\\n const MainLayout = ({ children }) => { return <div className='flex flex-col min-h-screen'><Navbar /><main className='flex-grow'>{children}</main><Footer /></div>; }; \\\\n export default MainLayout;\",\n\n            \"pages/Home.jsx\": \"import React from 'react';\\\\n import ThemeToggle from '../components/ThemeToggle';\\\\n const Home = () => { return <div className='text-center p-10'><h1 className='text-4xl font-bold'>Welcome to DWARF AI üöÄ</h1><p className='mt-4'>AI-powered coding assistant</p><ThemeToggle /></div>; }; \\\\n export default Home;\",\n\n            \"pages/About.jsx\": \"import React from 'react';\\\\n const About = () => { return <div className='text-center p-10'><h1 className='text-3xl font-bold'>About DWARF AI ü§ñ</h1><p className='mt-4'>A powerful AI for generating high-quality React code.</p></div>; }; \\\\n export default About;\",\n\n            \"hooks/useTheme.jsx\": \"import { useState } from 'react';\\\\n export default function useTheme() { const [theme, setTheme] = useState('light'); return { theme, setTheme }; }\",\n\n            \"hooks/useFetch.jsx\": \"import { useState, useEffect } from 'react';\\\\n const useFetch = (url) => { const [data, setData] = useState(null); const [loading, setLoading] = useState(true); useEffect(() => { fetch(url).then(res => res.json()).then(setData).finally(() => setLoading(false)); }, [url]); return { data, loading }; }; \\\\n export default useFetch;\",\n\n            \"context/AppContext.jsx\": \"import { createContext, useState } from 'react';\\\\n export const AppContext = createContext(null);\\\\n export const AppProvider = ({ children }) => { const [theme, setTheme] = useState('light'); return (<AppContext.Provider value={{ theme, setTheme }}>{children}</AppContext.Provider>); };\",\n\n            \"services/api.jsx\": \"export const fetchData = async (endpoint) => { const response = await fetch(endpoint); return response.json(); };\",\n\n            \"utils/helpers.jsx\": \"export const formatDate = (date) => { return new Date(date).toLocaleDateString(); };\"\n        \n            ... and many other files....\n        },\n        \"dependencies\": \"npm install react-router-dom react-icons ...and other required dependencies\"\n    }\n\n    give response in the above{the above code is just an example with minimal code but u don't hold back ur code should be comprehensive/complex/production levle with all features/functionalities/components} format for following prompt:- "},
          ],
        },
        {
          role: "model",
          parts: [
            {text: "{\n    \"paths\": {\n        \"App.jsx\": \"/src/App.jsx\",\n        \"main.jsx\": \"/src/main.jsx\",\n        \"index.css\": \"/src/index.css\",\n        \"components/Navbar.jsx\": \"/src/components/Navbar.jsx\",\n        \"components/Footer.jsx\": \"/src/components/Footer.jsx\",\n        \"components/Button.jsx\": \"/src/components/Button.jsx\",\n        \"components/Card.jsx\": \"/src/components/Card.jsx\",\n        \"components/Loading.jsx\": \"/src/components/Loading.jsx\",\n        \"components/Error.jsx\": \"/src/components/Error.jsx\",\n        \"components/SearchBox.jsx\": \"/src/components/SearchBox.jsx\",\n        \"components/Pagination.jsx\": \"/src/components/Pagination.jsx\",\n        \"components/ThemeToggle.jsx\": \"/src/components/ThemeToggle.jsx\",\n        \"layouts/MainLayout.jsx\": \"/src/layouts/MainLayout.jsx\",\n        \"pages/Home.jsx\": \"/src/pages/Home.jsx\",\n        \"pages/About.jsx\": \"/src/pages/About.jsx\",\n        \"pages/Products.jsx\": \"/src/pages/Products.jsx\",\n        \"pages/ProductDetail.jsx\": \"/src/pages/ProductDetail.jsx\",\n        \"pages/Contact.jsx\": \"/src/pages/Contact.jsx\",\n        \"pages/NotFound.jsx\": \"/src/pages/NotFound.jsx\",\n        \"hooks/useTheme.jsx\": \"/src/hooks/useTheme.jsx\",\n        \"hooks/useFetch.jsx\": \"/src/hooks/useFetch.jsx\",\n        \"hooks/usePagination.jsx\": \"/src/hooks/usePagination.jsx\",\n        \"context/AppContext.jsx\": \"/src/context/AppContext.jsx\",\n        \"services/api.jsx\": \"/src/services/api.jsx\",\n        \"utils/helpers.jsx\": \"/src/utils/helpers.jsx\",\n        \"assets/logo.svg\": \"/src/assets/logo.svg\",\n        \"assets/placeholder.jpg\": \"/src/assets/placeholder.jpg\"\n    },\n    \"code\": {\n        \"App.jsx\": \"import React from 'react';\\nimport { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\\nimport MainLayout from './layouts/MainLayout';\\nimport Home from './pages/Home';\\nimport About from './pages/About';\\nimport Products from './pages/Products';\\nimport ProductDetail from './pages/ProductDetail';\\nimport Contact from './pages/Contact';\\nimport NotFound from './pages/NotFound';\\n\\nconst App = () => {\\n    return (\\n        <Router>\\n            <MainLayout>\\n                <Routes>\\n                    <Route path='/' element={<Home />} />\\n                    <Route path='/about' element={<About />} />\\n                    <Route path='/products' element={<Products />} />\\n                    <Route path='/products/:id' element={<ProductDetail />} />\\n                    <Route path='/contact' element={<Contact />} />\\n                    <Route path='*' element={<NotFound />} />\\n                </Routes>\\n            </MainLayout>\\n        </Router>\\n    );\\n};\\n\\nexport default App;\",\n        \"main.jsx\": \"import React from 'react';\\nimport ReactDOM from 'react-dom/client';\\nimport App from './App.jsx';\\nimport { AppProvider } from './context/AppContext.jsx';\\nimport './index.css';\\n\\nconst root = ReactDOM.createRoot(document.getElementById('root'));\\nroot.render(\\n    <React.StrictMode>\\n        <AppProvider>\\n            <App />\\n        </AppProvider>\\n    </React.StrictMode>\\n);\\n\",\n        \"index.css\": \"@tailwind base;\\n@tailwind components;\\n@tailwind utilities;\\n\\nbody {\\n  @apply bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100;\\n}\\n\",\n        \"components/Navbar.jsx\": \"import React, { useContext } from 'react';\\nimport { Link } from 'react-router-dom';\\nimport { FaShoppingCart } from 'react-icons/fa';\\nimport { AppContext } from '../context/AppContext.jsx';\\nimport ThemeToggle from './ThemeToggle.jsx';\\nimport Logo from '../assets/logo.svg';\\n\\nconst Navbar = () => {\\n    const { cart } = useContext(AppContext);\\n\\n    return (\\n        <nav className='bg-white dark:bg-gray-800 shadow-md py-4 px-6 flex items-center justify-between sticky top-0 z-50'>\\n            <Link to='/' className='flex items-center font-semibold text-xl text-gray-800 dark:text-gray-100'>\\n                <img src={Logo} alt='Logo' className='h-8 w-auto mr-2' />\\n                DWARF AI\\n            </Link>\\n\\n            <div className='flex items-center space-x-6'>\\n                <Link to='/' className='hover:text-blue-500 dark:hover:text-blue-400'>Home</Link>\\n                <Link to='/products' className='hover:text-blue-500 dark:hover:text-blue-400'>Products</Link>\\n                <Link to='/about' className='hover:text-blue-500 dark:hover:text-blue-400'>About</Link>\\n                <Link to='/contact' className='hover:text-blue-500 dark:hover:text-blue-400'>Contact</Link>\\n                <Link to='/cart' className='relative hover:text-blue-500 dark:hover:text-blue-400'>\\n                    <FaShoppingCart className='h-6 w-6' />\\n                    {cart.length > 0 && (\\n                        <span className='absolute -top-2 -right-2 bg-red-500 text-white rounded-full text-xs px-1.5 py-0.5'>{cart.length}</span>\\n                    )}\\n                </Link>\\n                <ThemeToggle />\\n            </div>\\n        </nav>\\n    );\\n};\\n\\nexport default Navbar;\",\n        \"components/Footer.jsx\": \"import React from 'react';\\n\\nconst Footer = () => {\\n    return (\\n        <footer className='bg-gray-800 dark:bg-gray-900 text-white py-6 px-6 text-center'>\\n            <p>&copy; {new Date().getFullYear()} DWARF AI. All rights reserved.</p>\\n        </footer>\\n    );\\n};\\n\\nexport default Footer;\",\n        \"components/Button.jsx\": \"import React from 'react';\\n\\nconst Button = ({ children, onClick, type = 'button', className = '', disabled = false }) => {\\n    return (\\n        <button\\n            type={type}\\n            onClick={onClick}\\n            className={`px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-400 disabled:opacity-50 ${className}`}\\n            disabled={disabled}\\n            aria-label={children}\\n        >\\n            {children}\\n        </button>\\n    );\\n};\\n\\nexport default Button;\",\n        \"components/Card.jsx\": \"import React from 'react';\\nimport { Link } from 'react-router-dom';\\n\\nconst Card = ({ product }) => {\\n    const { id, title, price, image } = product;\\n\\n    return (\\n        <div className='bg-white dark:bg-gray-700 rounded-lg shadow-md overflow-hidden flex flex-col h-full'>\\n            <img src={image} alt={title} className='w-full h-48 object-cover object-center' />\\n            <div className='p-4 flex flex-col justify-between flex-grow'>\\n                <div>\\n                    <h3 className='text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2'>{title}</h3>\\n                    <p className='text-gray-600 dark:text-gray-400'>${price}</p>\\n                </div>\\n                <Link to={`/products/${id}`} className='mt-4 block text-center px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-400'>\\n                    View Details\\n                </Link>\\n            </div>\\n        </div>\\n    );\\n};\\n\\nexport default Card;\",\n        \"components/Loading.jsx\": \"import React from 'react';\\nimport { FaSpinner } from 'react-icons/fa';\\n\\nconst Loading = () => {\\n    return (\\n        <div className='flex items-center justify-center h-48'>\\n            <FaSpinner className='animate-spin text-4xl text-blue-500' aria-label='Loading...' />\\n        </div>\\n    );\\n};\\n\\nexport default Loading;\",\n        \"components/Error.jsx\": \"import React from 'react';\\n\\nconst Error = ({ message }) => {\\n    return (\\n        <div className='text-red-500 text-center p-4'>\\n            Error: {message}\\n        </div>\\n    );\\n};\\n\\nexport default Error;\",\n        \"components/SearchBox.jsx\": \"import React, { useState } from 'react';\\n\\nconst SearchBox = ({ onSearch }) => {\\n    const [searchTerm, setSearchTerm] = useState('');\\n\\n    const handleChange = (event) => {\\n        setSearchTerm(event.target.value);\\n    };\\n\\n    const handleSubmit = (event) => {\\n        event.preventDefault();\\n        onSearch(searchTerm);\\n    };\\n\\n    return (\\n        <form onSubmit={handleSubmit} className='flex items-center'>\\n            <input\\n                type='text'\\n                placeholder='Search products...'\\n                value={searchTerm}\\n                onChange={handleChange}\\n                className='px-4 py-2 rounded-l border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-400 dark:bg-gray-800 dark:text-gray-100'\\n                aria-label='Search products'\\n            />\\n            <button\\n                type='submit'\\n                className='px-4 py-2 rounded-r bg-blue-600 text-white hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-400'\\n                aria-label='Submit search'\\n            >\\n                Search\\n            </button>\\n        </form>\\n    );\\n};\\n\\nexport default SearchBox;\",\n        \"components/Pagination.jsx\": \"import React from 'react';\\n\\nconst Pagination = ({ currentPage, totalPages, onPageChange }) => {\\n    const pageNumbers = [...Array(totalPages).keys()].map(i => i + 1);\\n\\n    return (\\n        <div className='flex justify-center mt-6'>\\n            <nav className='inline-flex rounded-md shadow-sm -space-x-px' aria-label='Pagination'>\\n                <button\\n                    onClick={() => onPageChange(currentPage - 1)}\\n                    disabled={currentPage === 1}\\n                    className='px-4 py-2 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:z-10 disabled:opacity-50 rounded-l-md'\\n                    aria-label='Previous page'\\n                >\\n                    Previous\\n                </button>\\n                {pageNumbers.map(number => (\\n                    <button\\n                        key={number}\\n                        onClick={() => onPageChange(number)}\\n                        className={`px-4 py-2 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:z-10 ${currentPage === number ? 'bg-blue-100 text-blue-700' : ''}`}\\n                        aria-current={currentPage === number ? 'page' : null}\\n                        aria-label={`Go to page ${number}`}\\n                    >\\n                        {number}\\n                    </button>\\n                ))}\\n                <button\\n                    onClick={() => onPageChange(currentPage + 1)}\\n                    disabled={currentPage === totalPages}\\n                    className='px-4 py-2 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:z-10 disabled:opacity-50 rounded-r-md'\\n                    aria-label='Next page'\\n                >\\n                    Next\\n                </button>\\n            </nav>\\n        </div>\\n    );\\n};\\n\\nexport default Pagination;\",\n        \"components/ThemeToggle.jsx\": \"import React, { useContext } from 'react';\\nimport { AppContext } from '../context/AppContext.jsx';\\nimport { FaSun, FaMoon } from 'react-icons/fa';\\n\\nconst ThemeToggle = () => {\\n    const { theme, setTheme } = useContext(AppContext);\\n\\n    return (\\n        <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')} aria-label='Toggle theme'>\\n            {theme === 'light' ? <FaMoon className='h-6 w-6 text-gray-800' /> : <FaSun className='h-6 w-6 text-gray-100' />}\\n        </button>\\n    );\\n};\\n\\nexport default ThemeToggle;\",\n        \"layouts/MainLayout.jsx\": \"import React from 'react';\\nimport Navbar from '../components/Navbar.jsx';\\nimport Footer from '../components/Footer.jsx';\\n\\nconst MainLayout = ({ children }) => {\\n    return (\\n        <div className='flex flex-col min-h-screen'>\\n            <Navbar />\\n            <main className='flex-grow py-8 px-6'>{children}</main>\\n            <Footer />\\n        </div>\\n    );\\n};\\n\\nexport default MainLayout;\",\n        \"pages/Home.jsx\": \"import React from 'react';\\n\\nconst Home = () => {\\n    return (\\n        <div className='text-center'>\\n            <h1 className='text-4xl font-bold mb-4'>Welcome to DWARF AI</h1>\\n            <p className='text-lg'>Your AI-powered coding assistant</p>\\n        </div>\\n    );\\n};\\n\\nexport default Home;\",\n        \"pages/About.jsx\": \"import React from 'react';\\n\\nconst About = () => {\\n    return (\\n        <div className='text-center'>\\n            <h1 className='text-3xl font-bold mb-4'>About Us</h1>\\n            <p className='text-lg'>DWARF AI is a cutting-edge AI designed to help developers write better code, faster.</p>\\n        </div>\\n    );\\n};\\n\\nexport default About;\",\n        \"pages/Products.jsx\": \"import React, { useState } from 'react';\\nimport Card from '../components/Card.jsx';\\nimport Loading from '../components/Loading.jsx';\\nimport Error from '../components/Error.jsx';\\nimport SearchBox from '../components/SearchBox.jsx';\\nimport Pagination from '../components/Pagination.jsx';\\nimport useFetch from '../hooks/useFetch.jsx';\\nimport usePagination from '../hooks/usePagination.jsx';\\n\\nconst Products = () => {\\n    const [searchTerm, setSearchTerm] = useState('');\\n    const { data: products, loading, error } = useFetch('https://picsum.photos/v2/list?page=1&limit=20'); // Using Picsum for placeholder images\\n    const { currentPage, itemsPerPage, totalItems, paginatedItems, onPageChange } = usePagination(products, 6);\\n\\n    const handleSearch = (term) => {\\n        setSearchTerm(term);\\n    };\\n\\n    const filteredProducts = paginatedItems?.filter(product =>\\n        product.author.toLowerCase().includes(searchTerm.toLowerCase())\\n    );\\n\\n    if (loading) return <Loading />;\\n    if (error) return <Error message={error.message} />;\\n\\n    return (\\n        <div>\\n            <SearchBox onSearch={handleSearch} />\\n            <div className='grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4 mt-4'>\\n                {filteredProducts?.map(product => (\\n                    <Card key={product.id} product={{ id: product.id, title: product.author, price: Math.floor(Math.random() * 100), image: product.download_url }} />\\n                ))}\\n            </div>\\n            <Pagination currentPage={currentPage} totalPages={Math.ceil(totalItems / itemsPerPage)} onPageChange={onPageChange} />\\n        </div>\\n    );\\n};\\n\\nexport default Products;\",\n        \"pages/ProductDetail.jsx\": \"import React, { useState, useEffect, useContext } from 'react';\\nimport { useParams, useNavigate } from 'react-router-dom';\\nimport { AppContext } from '../context/AppContext.jsx';\\nimport Loading from '../components/Loading.jsx';\\nimport Error from '../components/Error.jsx';\\nimport Button from '../components/Button.jsx';\\n\\nconst ProductDetail = () => {\\n    const { id } = useParams();\\n    const navigate = useNavigate();\\n    const { cart, setCart } = useContext(AppContext);\\n    const [product, setProduct] = useState(null);\\n    const [loading, setLoading] = useState(true);\\n    const [error, setError] = useState(null);\\n\\n    useEffect(() => {\\n        // Simulate API call\\n        setTimeout(() => {\\n            // Using a fixed product for demonstration\\n            const fakeProduct = {\\n                id: id,\\n                title: `Product ${id}`,\\n                description: 'This is a detailed description of the product.',\\n                price: Math.floor(Math.random() * 100),\\n                image: `https://picsum.photos/id/${id}/400/300` // Example image\\n            };\\n\\n            setProduct(fakeProduct);\\n            setLoading(false);\\n        }, 500);\\n    }, [id]);\\n\\n    const handleAddToCart = () => {\\n        setCart([...cart, product]);\\n        navigate('/cart'); // Redirect to cart after adding\\n    };\\n\\n    if (loading) return <Loading />;\\n    if (error) return <Error message={error} />;\\n    if (!product) return <Error message='Product not found.' />;\\n\\n    return (\\n        <div className='max-w-3xl mx-auto p-6 bg-white dark:bg-gray-700 rounded-lg shadow-md'>\\n            <img src={product.image} alt={product.title} className='w-full h-64 object-cover object-center rounded-md mb-4' />\\n            <h1 className='text-2xl font-bold text-gray-800 dark:text-gray-100 mb-2'>{product.title}</h1>\\n            <p className='text-gray-700 dark:text-gray-300 mb-4'>{product.description}</p>\\n            <p className='text-xl font-semibold text-gray-900 dark:text-gray-200 mb-4'>${product.price}</p>\\n            <Button onClick={handleAddToCart}>Add to Cart</Button>\\n        </div>\\n    );\\n};\\n\\nexport default ProductDetail;\",\n        \"pages/Contact.jsx\": \"import React, { useState } from 'react';\\nimport Button from '../components/Button.jsx';\\n\\nconst Contact = () => {\\n    const [formData, setFormData] = useState({\\n        name: '',\\n        email: '',\\n        message: ''\\n    });\\n\\n    const handleChange = (e) => {\\n        setFormData({\\n            ...formData,\\n            [e.target.name]: e.target.value\\n        });\\n    };\\n\\n    const handleSubmit = (e) => {\\n        e.preventDefault();\\n        // Handle form submission logic here\\n        alert('Form submitted!');\\n    };\\n\\n    return (\\n        <div className='max-w-md mx-auto p-6 bg-white dark:bg-gray-700 rounded-lg shadow-md'>\\n            <h1 className='text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4'>Contact Us</h1>\\n            <form onSubmit={handleSubmit}>\\n                <div className='mb-4'>\\n                    <label htmlFor='name' className='block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2'>Name:</label>\\n                    <input\\n                        type='text'\\n                        id='name'\\n                        name='name'\\n                        value={formData.name}\\n                        onChange={handleChange}\\n                        className='shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:bg-gray-800 dark:text-gray-100 leading-tight focus:outline-none focus:shadow-outline'\\n                        required\\n                        aria-label='Your name'\\n                    />\\n                </div>\\n                <div className='mb-4'>\\n                    <label htmlFor='email' className='block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2'>Email:</label>\\n                    <input\\n                        type='email'\\n                        id='email'\\n                        name='email'\\n                        value={formData.email}\\n                        onChange={handleChange}\\n                        className='shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:bg-gray-800 dark:text-gray-100 leading-tight focus:outline-none focus:shadow-outline'\\n                        required\\n                        aria-label='Your email'\\n                    />\\n                </div>\\n                <div className='mb-6'>\\n                    <label htmlFor='message' className='block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2'>Message:</label>\\n                    <textarea\\n                        id='message'\\n                        name='message'\\n                        value={formData.message}\\n                        onChange={handleChange}\\n                        className='shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 dark:bg-gray-800 dark:text-gray-100 leading-tight focus:outline-none focus:shadow-outline'\\n                        rows='4'\\n                        required\\n                        aria-label='Your message'\\n                    ></textarea>\\n                </div>\\n                <Button type='submit'>Submit</Button>\\n            </form>\\n        </div>\\n    );\\n};\\n\\nexport default Contact;\",\n        \"pages/NotFound.jsx\": \"import React from 'react';\\nimport { Link } from 'react-router-dom';\\n\\nconst NotFound = () => {\\n    return (\\n        <div className='text-center'>\\n            <h1 className='text-4xl font-bold mb-4'>404 - Not Found</h1>\\n            <p className='text-lg'>The page you are looking for does not exist.</p>\\n            <Link to='/' className='text-blue-500 hover:underline'>Go back home</Link>\\n        </div>\\n    );\\n};\\n\\nexport default NotFound;\",\n        \"hooks/useTheme.jsx\": \"import { useState, useEffect } from 'react';\\n\\nconst useTheme = () => {\\n    const [theme, setTheme] = useState(localStorage.getItem('theme') || 'light');\\n\\n    useEffect(() => {\\n        localStorage.setItem('theme', theme);\\n        document.documentElement.setAttribute('data-theme', theme);\\n    }, [theme]);\\n\\n    return {\\n        theme,\\n        setTheme\\n    };\\n};\\n\\nexport default useTheme;\",\n        \"hooks/useFetch.jsx\": \"import { useState, useEffect } from 'react';\\n\\nconst useFetch = (url) => {\\n    const [data, setData] = useState(null);\\n    const [loading, setLoading] = useState(true);\\n    const [error, setError] = useState(null);\\n\\n    useEffect(() => {\\n        const fetchData = async () => {\\n            try {\\n                const response = await fetch(url);\\n                if (!response.ok) {\\n                    throw new Error(`HTTP error! status: ${response.status}`);\\n                }\\n                const json = await response.json();\\n                setData(json);\\n            } catch (e) {\\n                setError(e);\\n            } finally {\\n                setLoading(false);\\n            }\\n        };\\n\\n        fetchData();\\n    }, [url]);\\n\\n    return {\\n        data,\\n        loading,\\n        error\\n    };\\n};\\n\\nexport default useFetch;\",\n        \"hooks/usePagination.jsx\": \"import { useState, useEffect } from 'react';\\n\\nconst usePagination = (data, itemsPerPage) => {\\n    const [currentPage, setCurrentPage] = useState(1);\\n    const [paginatedItems, setPaginatedItems] = useState([]);\\n\\n    const totalItems = data?.length || 0;\\n    const totalPages = Math.ceil(totalItems / itemsPerPage);\\n\\n    useEffect(() => {\\n        if (data) {\\n            const startIndex = (currentPage - 1) * itemsPerPage;\\n            const endIndex = startIndex + itemsPerPage;\\n            setPaginatedItems(data.slice(startIndex, endIndex));\\n        }\\n    }, [data, currentPage, itemsPerPage]);\\n\\n    const onPageChange = (pageNumber) => {\\n        setCurrentPage(pageNumber);\\n    };\\n\\n    return {\\n        currentPage,\\n        itemsPerPage,\\n        totalItems,\\n        totalPages,\\n        paginatedItems,\\n        onPageChange\\n    };\\n};\\n\\nexport default usePagination;\",\n        \"context/AppContext.jsx\": \"import React, { createContext, useState } from 'react';\\nimport useTheme from '../hooks/useTheme.jsx';\\n\\nexport const AppContext = createContext(null);\\n\\nexport const AppProvider = ({ children }) => {\\n    const { theme, setTheme } = useTheme();\\n    const [cart, setCart] = useState([]);\\n\\n    const value = {\\n        theme,\\n        setTheme,\\n        cart,\\n        setCart\\n    };\\n\\n    return (\\n        <AppContext.Provider value={value}>\\n            {children}\\n        </AppContext.Provider>\\n    );\\n};\\n\",\n        \"services/api.jsx\": \"export const fetchData = async (endpoint) => {\\n    try {\\n        const response = await fetch(endpoint);\\n        if (!response.ok) {\\n            throw new Error(`HTTP error! status: ${response.status}`);\\n        }\\n        return await response.json();\\n    } catch (error) {\\n        console.error('API Error:', error);\\n        throw error;\\n    }\\n};\\n\",\n        \"utils/helpers.jsx\": \"export const formatDate = (date) => {\\n    return new Date(date).toLocaleDateString();\\n};\\n\\nexport const truncateText = (text, maxLength) => {\\n    if (text.length > maxLength) {\\n        return text.substring(0, maxLength) + '...';\\n    }\\n    return text;\\n};\",\n        \"assets/logo.svg\": \"<svg viewBox=\\\"0 0 24 24\\\" fill=\\\"currentColor\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71L12 2z\\\"/></svg>\",\n        \"assets/placeholder.jpg\": \"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAoHBwkHBgoJCAgLCgkMDhgODR0UFhYTFhkeGh0sHhMlLiIlLzEqKgpFQ0RDQ0NHRUcKRA3EBwkTFhUWEV0VFhH/2wBDAQoLCgkMDhgODR0UFhYTFhkeGh0sHhMlLiIlLzEqKgpFQ0RDQ0NHRUcKRA3EBwkTFhUWEV0VFhH/wAARCAAgACADASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAX/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/EABUBAQEAAAAAAAAAAAAAAAAAAABH/9oADAMBAAIRAxEAPwBcXAQAAA//Z\"\n    },\n    \"dependencies\": \"npm install react react-dom react-router-dom react-icons tailwindcss postcss autoprefixer daisyui\"\n"},
          ],
        },
      ],
    });

    const result = await chatSession.sendMessage(`${reactPrompt} ${projectGoal}`);
    
    let responseText = result.response.text();
    responseText = responseText.replace(/^```json\s*/, "").replace(/```$/, "");

    return responseText;
  } catch (error) {
    console.error("‚ùå AI Service Error:", error);
    return null;
  }
}

module.exports = { generateCode };
